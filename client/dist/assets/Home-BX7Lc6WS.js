import{u as e,b as s,c as a,j as t,d as i,y as l,e as r}from"./index-VcG33-XY.js";import{b as o}from"./vendor-aDN--sgP.js";import{G as n}from"./iconBase-GrFdhYN9.js";import{a as d,b as c,c as m,d as u}from"./index-Dp7F7cCd.js";import{L as p,F as h,a as x}from"./Layout-Cm6lD_Oj.js";import{R as j,C as g}from"./ReactTimeAgo-D_6RWNux.js";function v(e){return n({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"11 17 6 12 11 7"},child:[]},{tag:"polyline",attr:{points:"18 17 13 12 18 7"},child:[]}]})(e)}function f(e){return n({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"13 17 18 12 13 7"},child:[]},{tag:"polyline",attr:{points:"6 17 11 12 6 7"},child:[]}]})(e)}const y=()=>{const i=o.useRef(null),{user:l}=e(e=>e.user),{data:r,isLoading:n,refetch:d}=s(),[c,{isLoading:m}]=a(),[u,p]=o.useState({open:!1,userStories:[],idx:0}),h=o.useRef(null),[x,j]=o.useState("");console.log(r);const g=e=>{if(i.current){const{scrollLeft:s}=i.current,a=200;i.current.scrollTo({left:"left"===e?s-a:s+a,behavior:"smooth"})}},y=()=>p({open:!1,userStories:[],idx:0});return t.jsxs("div",{className:"stories-wrapper",children:[t.jsxs("button",{className:"stories-nav left",onClick:()=>g("left"),children:[" ",t.jsx(v,{})," "]}),t.jsxs("div",{className:"stories",ref:i,children:[t.jsxs("div",{className:"story",children:[t.jsx("img",{src:null==l?void 0:l.profilePicture,alt:null==l?void 0:l.name,loading:"lazy"}),t.jsx("div",{className:"create-story-icon",children:t.jsxs("span",{className:"pointer",onClick:()=>h.current.click(),children:[m?t.jsx("span",{className:"story-uploading",children:"..."}):"+",t.jsx("input",{type:"file",ref:h,accept:"image/*,video/*",style:{display:"none"},onChange:async e=>{var s;j("");const a=e.target.files[0];if(!a)return;if(!a.type.startsWith("image/")&&!a.type.startsWith("video/"))return void j("File harus berupa gambar atau video.");if(a.size>15728640)return void j("Ukuran file maksimal 15MB.");const t=new FormData;t.append("file",a);try{await c(t).unwrap()}catch(i){j((null==(s=null==i?void 0:i.data)?void 0:s.error)||"Gagal upload story")}e.target.value=""},disabled:m})]})}),t.jsx("div",{className:"story-name",children:t.jsx("p",{children:"Create Story"})})]}),!n&&(null==r?void 0:r.map(e=>t.jsxs("div",{className:"story",onClick:()=>(e=>{p({open:!0,userStories:e.stories,idx:0,user:e.user})})(e),children:["image"===e.stories[0].fileType?t.jsx("img",{src:e.stories[0].fileUrl,alt:"story"}):t.jsx("video",{src:e.stories[0].fileUrl,alt:"story",style:{width:"100%",height:"100%",objectFit:"cover"},muted:!0}),t.jsx("div",{className:"story-avatar",children:t.jsx("img",{src:e.user.profilePicture,alt:`${e.user.firstName} ${e.user.lastName}`})}),t.jsx("div",{className:"story-name",children:t.jsx("p",{children:`${e.user.firstName} ${e.user.lastName}`})})]},e.user._id)))]}),t.jsxs("button",{className:"stories-nav right",onClick:()=>g("right"),children:[" ",t.jsx(f,{})," "]}),u.open&&t.jsx("div",{className:"story-modal",onClick:y,children:t.jsxs("div",{className:"story-modal-content",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"story-modal-header",children:[t.jsx("img",{src:u.user.profilePicture,alt:`${u.user.firstName} ${u.user.lastName}`,className:"story-modal-avatar"}),t.jsx("span",{children:`${u.user.firstName} ${u.user.lastName}`}),t.jsx("button",{onClick:y,className:"close-btn",children:"×"})]}),t.jsx("div",{className:"story-modal-body",children:"image"===u.userStories[u.idx].fileType?t.jsx("img",{src:u.userStories[u.idx].fileUrl,alt:"story",className:"story-modal-img"}):t.jsx("video",{src:u.userStories[u.idx].fileUrl,controls:!0,className:"story-modal-img"})}),t.jsxs("div",{className:"story-modal-footer",children:[t.jsx("button",{onClick:()=>p(e=>({...e,idx:Math.max(e.idx-1,0)})),disabled:0===u.idx,children:"Prev"}),t.jsxs("span",{children:[u.idx+1," / ",u.userStories.length]}),t.jsx("button",{onClick:()=>p(e=>({...e,idx:Math.min(e.idx+1,e.userStories.length-1)})),disabled:u.idx===u.userStories.length-1,children:"Next"})]})]})}),x&&t.jsx("div",{className:"story-error",children:x})]})};function N(e){return n({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M22,3 L2,11 L20.5,19 L22,3 Z M10,20.5 L13,16 M15.5,9.5 L9,14 L9.85884537,20.0119176 C9.93680292,20.5576204 10.0751625,20.5490248 10.1651297,20.009222 L11,15 L15.5,9.5 Z"},child:[]}]})(e)}const b=()=>{const{user:s}=e(e=>e.user),a=o.useRef(null),r=o.useRef(null),[n,d]=o.useState(""),[c,m]=o.useState([]),[u,p]=o.useState(!1),[h,{isLoading:x,error:j,isSuccess:g,data:v}]=i();o.useEffect(()=>{const e=()=>{p(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);return o.useEffect(()=>{g&&(d(""),m([]),r.current&&(r.current.style.height="auto"),l.success(v.message)),j&&l.error(j.data.message)},[g,j,v]),t.jsxs("div",{className:"post-add",children:[t.jsxs("div",{className:"post-add-header d-flex",children:[t.jsx("div",{className:"image",children:t.jsx("img",{src:s.profilePicture,alt:"user",loading:"lazy"})}),t.jsx("textarea",{ref:r,type:"text",placeholder:`What's on your mind ${null==s?void 0:s.fullName}?`,value:n,onInput:e=>{d(e.target.value);const s=r.current;s.style.height="auto";const a=u?120:200,t=Math.min(s.scrollHeight,a);s.style.height=t+"px"},rows:1,disabled:x})]}),c.length>0&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:u?"8px":"12px",marginBottom:"12px"},children:c.map((e,s)=>t.jsxs("div",{className:"media-preview",children:[t.jsx("button",{type:"button",onClick:()=>(e=>{m(s=>(URL.revokeObjectURL(s[e].url),s.filter((s,a)=>a!==e))),a.current&&(a.current.value=null)})(s),className:"remove-media-btn","aria-label":"Remove preview",disabled:x,children:"×"}),"image"===e.type&&t.jsx("img",{src:e.url,alt:"preview"}),"video"===e.type&&t.jsx("video",{src:e.url,controls:!0})]},e.url))}),t.jsx("hr",{className:"post-divider"}),t.jsxs("div",{className:"post-add-actions-row",children:[t.jsxs("button",{type:"button",className:"action-btn",onClick:()=>{a.current.click()},"aria-label":"Add image or video",disabled:x,children:[t.jsx("input",{type:"file",className:"file-input",ref:a,accept:"image/*,video/*",multiple:!0,onChange:e=>{const s=Array.from(e.target.files);let a=[],t=c.length;for(const i of s){if(i.size>52428800){alert(`File '${i.name}' size must be less than 50MB`);continue}if(t+a.length>=10){alert("Maximum 10 media files allowed per post.");break}const e=URL.createObjectURL(i),s=i.type.startsWith("image")?"image":i.type.startsWith("video")?"video":null;s&&a.push({file:i,url:e,type:s})}m(e=>[...e,...a].slice(0,10)),e.target.value=null},disabled:x||c.length>=10}),t.jsx("span",{className:"icon image-icon"}),u?"Media":"Add Image / Video"]}),t.jsxs("button",{type:"button",className:"action-btn","aria-label":"Tag friends",disabled:x,children:[t.jsx("span",{className:"icon tag-icon"}),u?"Tag":"Tag Friends"]}),t.jsx("button",{type:"button",className:"share-btn",onClick:async()=>{if(!n.trim()&&0===c.length)return void alert("Please add some text or media before sharing");const e=new FormData;e.append("content",n),c.forEach(s=>{"image"===s.type?e.append("images",s.file):"video"===s.type&&e.append("videos",s.file)}),e.append("taggedUsers",JSON.stringify([])),e.append("location",JSON.stringify({})),h(e)},disabled:!n.trim()&&0===c.length||x,"aria-label":"Share post",children:x?"Sharing...":t.jsx(N,{})})]})]})},k=()=>{var s;const{user:a}=e(e=>e.user),{data:i,isLoading:l,error:n}=r(),x=i||[],[v,f]=o.useState(!1),[y,N]=o.useState([]),[b,k]=o.useState(0),C=(e,s)=>{N(e),k(s),f(!0)},L=()=>{f(!1),N([]),k(0)};return l?t.jsx(p,{}):t.jsxs("div",{className:"d-flex flex-column",children:[v&&t.jsx("div",{className:"media-modal-overlay",onClick:L,children:t.jsxs("div",{className:"media-modal-content",onClick:e=>e.stopPropagation(),children:[t.jsx("button",{className:"media-modal-close",onClick:L,children:t.jsx(d,{})}),t.jsx("button",{className:"media-modal-prev",onClick:()=>{k(e=>0===e?y.length-1:e-1)},children:t.jsx(c,{})}),t.jsx("button",{className:"media-modal-next",onClick:()=>{k(e=>e===y.length-1?0:e+1)},children:t.jsx(m,{})}),"image"===(null==(s=y[b])?void 0:s.type)?t.jsx("img",{src:y[b].src,alt:"media",className:"media-modal-img"}):t.jsx("video",{src:y[b].src,controls:!0,className:"media-modal-video"})]})}),null==x?void 0:x.map(e=>{var s,i;const l=[...(null==(s=e.images)?void 0:s.map(e=>({type:"image",src:e})))||[],...(null==(i=e.videos)?void 0:i.map(e=>({type:"video",src:e})))||[]];return t.jsxs("div",{className:"post-list",children:[t.jsx("div",{className:"post-list-header",children:t.jsxs("div",{className:"post-list-header-left",children:[t.jsx("img",{src:e.author.profilePicture||"https://avitek.vn/wp-content/uploads/2020/08/Image-Placeholder-Dark.png",alt:"avatar",loading:"lazy"}),t.jsxs("div",{className:"post-list-header-info",children:[t.jsxs("span",{className:"post-list-header-info-name",children:[e.author.firstName," ",e.author.lastName]}),t.jsx("span",{className:"post-list-header-info-time",children:t.jsx(j,{date:e.createdAt,locale:"en-EN"})})]})]})}),t.jsxs("div",{className:"post-list-content",children:[t.jsx("div",{className:"post-list-content-text",children:t.jsx("span",{children:e.content})}),1===l.length?t.jsx("div",{className:"post-list-content-single-media",onClick:()=>C(l,0),children:"image"===l[0].type?t.jsx("img",{src:l[0].src,alt:"gallery",loading:"lazy"}):t.jsx("video",{src:l[0].src,loading:"lazy"})}):l.length>1&&t.jsx("div",{className:"post-list-gallery-grid",children:l.slice(0,4).map((e,s)=>t.jsxs("div",{className:"post-list-gallery-item",onClick:()=>C(l,s),children:["image"===e.type?t.jsx("img",{src:e.src,alt:"gallery",loading:"lazy"}):t.jsx("video",{src:e.src,loading:"lazy"}),3===s&&l.length>4&&t.jsxs("div",{className:"post-list-gallery-more",children:["+",l.length-4]})]},s))})]}),t.jsxs("div",{className:"post-list-footer",children:[t.jsx("span",{className:"post-list-footer-like",children:t.jsx(h,{})}),t.jsx("span",{className:"post-list-footer-share",children:t.jsx(u,{})})]}),t.jsx(g,{postId:e._id,comments:e.comments,currentUser:a})]},e._id)})]})},C=()=>t.jsxs("div",{className:"flex-2 d-flex flex-column post",children:[t.jsx(b,{}),t.jsx(y,{}),t.jsx(k,{})]}),L=()=>t.jsx(x,{children:t.jsx(C,{})});export{L as default};
//# sourceMappingURL=Home-BX7Lc6WS.js.map
