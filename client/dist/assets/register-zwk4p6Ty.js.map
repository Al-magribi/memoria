{"version":3,"file":"register-zwk4p6Ty.js","sources":["../../src/pages/register/register.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport \"./register.scss\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { MdExpandMore } from \"react-icons/md\";\r\nimport { useRegisterMutation } from \"../../services/api/user/UserApi\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { isAuthenticated } from \"../../utils/auth\";\r\n\r\nconst Register = () => {\r\n  const navigate = useNavigate();\r\n\r\n  const { user } = useSelector((state) => state.user);\r\n\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [errors, setErrors] = useState({});\r\n  const [register, { isLoading }] = useRegisterMutation();\r\n\r\n  const [data, setData] = useState({\r\n    username: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    confirmPassword: \"\",\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    dateOfBirth: \"\",\r\n    gender: \"Prefer not to say\",\r\n  });\r\n\r\n  const handleChange = (e) => {\r\n    setData({ ...data, [e.target.name]: e.target.value });\r\n    // Clear error when user starts typing\r\n    if (errors[e.target.name]) {\r\n      setErrors({ ...errors, [e.target.name]: \"\" });\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {};\r\n\r\n    // Username validation\r\n    if (!data.username) {\r\n      newErrors.username = \"Username is required\";\r\n    } else if (data.username.length < 3) {\r\n      newErrors.username = \"Username must be at least 3 characters\";\r\n    } else if (!/^[a-zA-Z0-9_]{3,30}$/.test(data.username)) {\r\n      newErrors.username =\r\n        \"Username can only contain letters, numbers, and underscores\";\r\n    }\r\n\r\n    // Email validation\r\n    if (!data.email) {\r\n      newErrors.email = \"Email is required\";\r\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(data.email)) {\r\n      newErrors.email = \"Please enter a valid email address\";\r\n    }\r\n\r\n    // Password validation\r\n    if (!data.password) {\r\n      newErrors.password = \"Password is required\";\r\n    } else if (data.password.length < 6) {\r\n      newErrors.password = \"Password must be at least 6 characters\";\r\n    }\r\n\r\n    // Confirm password validation\r\n    if (!data.confirmPassword) {\r\n      newErrors.confirmPassword = \"Please confirm your password\";\r\n    } else if (data.password !== data.confirmPassword) {\r\n      newErrors.confirmPassword = \"Passwords do not match\";\r\n    }\r\n\r\n    // First name validation\r\n    if (!data.firstName) {\r\n      newErrors.firstName = \"First name is required\";\r\n    } else if (data.firstName.length > 50) {\r\n      newErrors.firstName = \"First name must be less than 50 characters\";\r\n    }\r\n\r\n    // Last name validation\r\n    if (!data.lastName) {\r\n      newErrors.lastName = \"Last name is required\";\r\n    } else if (data.lastName.length > 50) {\r\n      newErrors.lastName = \"Last name must be less than 50 characters\";\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    // Prepare data for backend (remove confirmPassword)\r\n    const body = {\r\n      username: data.username,\r\n      email: data.email,\r\n      password: data.password,\r\n      firstName: data.firstName,\r\n      lastName: data.lastName,\r\n      dateOfBirth: data.dateOfBirth || undefined,\r\n      gender: data.gender,\r\n    };\r\n\r\n    try {\r\n      const result = await toast.promise(register(body).unwrap(), {\r\n        pending: \"Creating your account...\",\r\n        success: {\r\n          render({ data }) {\r\n            return data?.message || \"Account created successfully!\";\r\n          },\r\n        },\r\n        error: {\r\n          render({ data }) {\r\n            return (\r\n              data?.data?.message || \"Registration failed. Please try again.\"\r\n            );\r\n          },\r\n        },\r\n      });\r\n\r\n      // If we reach here, registration was successful\r\n      // Redux slice will handle setting user and authentication state\r\n      // Just navigate to home page\r\n      setTimeout(() => {\r\n        navigate(\"/\");\r\n      }, 1500);\r\n    } catch (error) {\r\n      // Error is already handled by toast.promise\r\n      console.error(\"Registration error:\", error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth <= 768);\r\n    };\r\n\r\n    checkMobile();\r\n    window.addEventListener(\"resize\", checkMobile);\r\n\r\n    return () => window.removeEventListener(\"resize\", checkMobile);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Check if user is already signed in from localStorage\r\n    if (isAuthenticated() && user?.id) {\r\n      navigate(\"/\");\r\n    }\r\n  }, [user, navigate]);\r\n\r\n  return (\r\n    <div className='register d-flex-center'>\r\n      <div className='wrapper'>\r\n        <h1>{isMobile ? \"Welcome to Memoria\" : \"Create Account\"}</h1>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className='form-row'>\r\n            <div className='form-group'>\r\n              <input\r\n                type='text'\r\n                placeholder='First Name *'\r\n                name='firstName'\r\n                value={data.firstName}\r\n                onChange={handleChange}\r\n                className={errors.firstName ? \"error\" : \"\"}\r\n                disabled={isLoading}\r\n              />\r\n              {errors.firstName && (\r\n                <span className='error-text'>{errors.firstName}</span>\r\n              )}\r\n            </div>\r\n            <div className='form-group'>\r\n              <input\r\n                type='text'\r\n                placeholder='Last Name *'\r\n                name='lastName'\r\n                value={data.lastName}\r\n                onChange={handleChange}\r\n                className={errors.lastName ? \"error\" : \"\"}\r\n                disabled={isLoading}\r\n              />\r\n              {errors.lastName && (\r\n                <span className='error-text'>{errors.lastName}</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className='form-group'>\r\n            <input\r\n              type='text'\r\n              placeholder='Username *'\r\n              name='username'\r\n              value={data.username}\r\n              onChange={handleChange}\r\n              className={errors.username ? \"error\" : \"\"}\r\n              disabled={isLoading}\r\n            />\r\n            {errors.username && (\r\n              <span className='error-text'>{errors.username}</span>\r\n            )}\r\n          </div>\r\n\r\n          <div className='form-group'>\r\n            <input\r\n              type='email'\r\n              placeholder='Email *'\r\n              name='email'\r\n              value={data.email}\r\n              onChange={handleChange}\r\n              className={errors.email ? \"error\" : \"\"}\r\n              disabled={isLoading}\r\n            />\r\n            {errors.email && <span className='error-text'>{errors.email}</span>}\r\n          </div>\r\n\r\n          <div className='form-row'>\r\n            <div className='form-group'>\r\n              <input\r\n                type='date'\r\n                placeholder='Date of Birth'\r\n                name='dateOfBirth'\r\n                value={data.dateOfBirth}\r\n                onChange={handleChange}\r\n                disabled={isLoading}\r\n              />\r\n            </div>\r\n            <div className='form-group'>\r\n              <div className='select-wrapper'>\r\n                <select\r\n                  name='gender'\r\n                  value={data.gender}\r\n                  onChange={handleChange}\r\n                  disabled={isLoading}\r\n                >\r\n                  <option value='Prefer not to say'>Prefer not to say</option>\r\n                  <option value='Male'>Male</option>\r\n                  <option value='Female'>Female</option>\r\n                  <option value='Other'>Other</option>\r\n                </select>\r\n                <MdExpandMore className='select-icon' />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className='form-group'>\r\n            <input\r\n              type='password'\r\n              placeholder='Password *'\r\n              name='password'\r\n              value={data.password}\r\n              onChange={handleChange}\r\n              className={errors.password ? \"error\" : \"\"}\r\n              disabled={isLoading}\r\n            />\r\n            {errors.password && (\r\n              <span className='error-text'>{errors.password}</span>\r\n            )}\r\n          </div>\r\n\r\n          <div className='form-group'>\r\n            <input\r\n              type='password'\r\n              placeholder='Confirm Password *'\r\n              name='confirmPassword'\r\n              value={data.confirmPassword}\r\n              onChange={handleChange}\r\n              className={errors.confirmPassword ? \"error\" : \"\"}\r\n              disabled={isLoading}\r\n            />\r\n            {errors.confirmPassword && (\r\n              <span className='error-text'>{errors.confirmPassword}</span>\r\n            )}\r\n          </div>\r\n\r\n          <button type='submit' className='btn-primary' disabled={isLoading}>\r\n            {isLoading ? \"Creating Account...\" : \"Create Account\"}\r\n          </button>\r\n\r\n          <p className='signin-link'>\r\n            Already have an account?{\" \"}\r\n            <span onClick={() => navigate(\"/signin\")}>Sign in</span>\r\n          </p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Register;\r\n"],"names":["Register","navigate","useNavigate","user","useSelector","state","isMobile","setIsMobile","useState","errors","setErrors","register","isLoading","useRegisterMutation","data","setData","username","email","password","confirmPassword","firstName","lastName","dateOfBirth","gender","handleChange","e","target","name","value","useEffect","checkMobile","window","innerWidth","addEventListener","removeEventListener","isAuthenticated","id","className","children","jsxs","jsx","onSubmit","async","preventDefault","newErrors","length","test","Object","keys","validateForm","body","toast","promise","unwrap","pending","success","render","message","error","setTimeout","console","jsxRuntimeExports","type","placeholder","onChange","disabled","MdExpandMore","onClick"],"mappings":"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"}