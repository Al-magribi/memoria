import{j as e,o as s,p as i,q as a,r}from"./index-VcG33-XY.js";import{b as n}from"./vendor-aDN--sgP.js";import{k as l,l as t,m as c,L as d,a as o,f as m,n as h,o as u,O as j}from"./Layout-Cm6lD_Oj.js";import"./iconBase-GrFdhYN9.js";const f=()=>{const[s,i]=n.useState(""),[a,r]=n.useState([]),[d,o]=n.useState(!1),[m,h]=n.useState(!1);return e.jsxs("div",{className:"user-search",children:[e.jsxs("div",{className:"search-header",children:[e.jsx("h2",{children:"Find People"}),e.jsx("p",{children:"Search for people to connect with"})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),s.trim()){o(!0),h(!0);try{const e=await fetch(`/api/auth/search?q=${encodeURIComponent(s.trim())}`,{credentials:"include"});if(e.ok){const s=await e.json();r(s.users||[])}else console.error("Search failed"),r([])}catch(i){console.error("Error searching users:",i),r([])}finally{o(!1)}}},className:"search-form",children:e.jsxs("div",{className:"search-input-container",children:[e.jsx(l,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search by name or username...",value:s,onChange:e=>{i(e.target.value),e.target.value.trim()||(r([]),h(!1))},className:"search-input"}),e.jsx("button",{type:"submit",className:"search-button",disabled:d||!s.trim(),children:d?e.jsx(t,{className:"spinner"}):"Search"})]})}),e.jsxs("div",{className:"search-results",children:[d&&e.jsxs("div",{className:"loading-results",children:[e.jsx(t,{className:"spinner"}),e.jsx("span",{children:"Searching..."})]}),!d&&m&&e.jsx(e.Fragment,{children:a.length>0?e.jsxs("div",{className:"results-list",children:[e.jsxs("h3",{children:["Search Results (",a.length,")"]}),a.map(s=>e.jsxs("div",{className:"user-result",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("img",{src:s.profilePicture||"https://via.placeholder.com/50",alt:`${s.firstName} ${s.lastName}`,className:"user-avatar",onClick:()=>window.location.href=`/user/${s._id}`,style:{cursor:"pointer"}}),e.jsxs("div",{className:"user-details",children:[e.jsxs("h4",{onClick:()=>window.location.href=`/user/${s._id}`,style:{cursor:"pointer"},children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"username",children:["@",s.username]}),s.bio&&e.jsx("p",{className:"bio",children:s.bio}),s.title&&e.jsx("p",{className:"title",children:s.title})]})]}),e.jsx("div",{className:"user-actions",children:e.jsx(c,{userId:s._id,className:"search-friend-btn"})})]},s._id))]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['No users found matching "',s,'"']}),e.jsx("p",{className:"suggestion",children:"Try searching with a different name or username"})]})}),!m&&!d&&e.jsxs("div",{className:"search-tips",children:[e.jsx("h3",{children:"Search Tips"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Search by first name, last name, or username"}),e.jsx("li",{children:'Try partial matches (e.g., "john" will find "Johnny")'}),e.jsx("li",{children:"Use exact spelling for better results"})]})]})]})]})},x=()=>{const[t,c]=n.useState(!1),[x,N]=n.useState({}),[p,v]=n.useState("friends"),{data:g,isLoading:y}=s(),{data:b,isLoading:w}=i(),[S]=a(),[F]=r();n.useEffect(()=>{const e=()=>{c(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const q=e=>{t&&(window.location.href=`/user/${e}`)};if(y||w)return e.jsx(d,{});const C=(null==g?void 0:g.requests)||[],O=(null==b?void 0:b.friends)||[],$=O.filter(e=>e.isOnline);return O.filter(e=>!e.isOnline),e.jsx(o,{children:e.jsxs("div",{className:"friends",children:[e.jsxs("div",{className:"friends-nav",children:[e.jsxs("button",{className:"nav-tab "+("friends"===p?"active":""),onClick:()=>v("friends"),children:[e.jsx(m,{}),"Friends"]}),e.jsxs("button",{className:"nav-tab "+("search"===p?"active":""),onClick:()=>v("search"),children:[e.jsx(l,{}),"Find People"]})]}),"friends"===p&&e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"friends-title",children:t?"Friend Requests":"Friends Requests"}),e.jsx("div",{className:"friends-list",children:C.map(s=>e.jsxs("div",{className:"friend-item",onClick:()=>q(s.requester.id),style:{cursor:t?"pointer":"default"},children:[e.jsx("img",{className:"friend-avatar",src:s.requester.profilePicture,alt:`${s.requester.firstName} ${s.requester.lastName}`,loading:"lazy"}),e.jsxs("div",{className:"friend-info",children:[e.jsxs("div",{className:"friend-name",children:[s.requester.firstName," ",s.requester.lastName]}),e.jsxs("div",{className:"friend-mutual",children:[e.jsx("span",{className:"mutual-icon",children:e.jsx(m,{})}),s.mutualFriendsCount," mutual friends"]}),e.jsxs("div",{className:"friend-actions",children:[e.jsxs("button",{className:"accept-btn",onClick:e=>{e.stopPropagation(),(async e=>{N(s=>({...s,[e]:!0}));try{await S(e),console.log(`Confirmed friend request for ID: ${e}`)}catch(s){console.error("Error accepting friend request:",s)}finally{N(s=>({...s,[e]:!1}))}})(s.id)},disabled:x[s.id],children:[x[s.id]?e.jsx("div",{className:"loading-spinner"}):e.jsx(h,{}),"Accept"]}),e.jsxs("button",{className:"reject-btn",onClick:e=>{e.stopPropagation(),(async e=>{N(s=>({...s,[e]:!0}));try{await F(e),console.log(`Rejected friend request for ID: ${e}`)}catch(s){console.error("Error rejecting friend request:",s)}finally{N(s=>({...s,[e]:!1}))}})(s.id)},disabled:x[s.id],children:[x[s.id]?e.jsx("div",{className:"loading-spinner"}):e.jsx(u,{}),"Reject"]})]})]})]},s.id))})]}),$.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"friends-title",children:["Online Friends (",$.length,")"]}),e.jsx("div",{className:"friends-list",children:$.map(s=>e.jsxs("div",{className:"friend-item online",onClick:()=>q(s.id),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"friend-avatar-container",children:[e.jsx("img",{className:"friend-avatar",src:s.profilePicture||"https://via.placeholder.com/50",alt:`${s.firstName} ${s.lastName}`,loading:"lazy"}),e.jsx(j,{userId:s.id,isOnlineFromAPI:s.isOnline,size:"small"})]}),e.jsxs("div",{className:"friend-info",children:[e.jsxs("div",{className:"friend-name",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"friend-status",children:"Online"}),e.jsxs("div",{className:"friend-mutual",children:[e.jsx("span",{className:"mutual-icon",children:e.jsx(m,{})}),s.mutualFriendsCount," mutual friends"]}),t&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#65676b",marginTop:"0.5rem",fontStyle:"italic"},children:"Tap to view profile"})]})]},s.id))})]}),e.jsxs("h2",{className:"friends-title",children:["All Friends (",O.length,")"]}),e.jsx("div",{className:"friends-list",children:O.length>0?O.map(s=>e.jsxs("div",{className:"friend-item "+(s.isOnline?"online":"offline"),onClick:()=>q(s.id),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"friend-avatar-container",children:[e.jsx("img",{className:"friend-avatar",src:s.profilePicture||"https://via.placeholder.com/50",alt:`${s.firstName} ${s.lastName}`,loading:"lazy"}),s.isOnline&&e.jsx(j,{userId:s.id,isOnlineFromAPI:s.isOnline,size:"small"})]}),e.jsxs("div",{className:"friend-info",children:[e.jsxs("div",{className:"friend-name",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"friend-status",children:s.isOnline?"Online":"Offline"}),e.jsxs("div",{className:"friend-mutual",children:[e.jsx("span",{className:"mutual-icon",children:e.jsx(m,{})}),s.mutualFriendsCount," mutual friends"]}),t&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#65676b",marginTop:"0.5rem",fontStyle:"italic"},children:"Tap to view profile"})]})]},s.id)):e.jsxs("div",{className:"no-friends",children:[e.jsx("p",{children:"No friends yet"}),e.jsx("p",{children:"Start connecting with people!"})]})})]}),"search"===p&&e.jsx(f,{})]})})};export{x as default};
//# sourceMappingURL=Friends-BpojQo1E.js.map
