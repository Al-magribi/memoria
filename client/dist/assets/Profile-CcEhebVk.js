import{j as s,f as e,u as a,g as i,h as l,y as t,k as n,l as c,m as o,n as d}from"./index-VcG33-XY.js";import{b as r}from"./vendor-aDN--sgP.js";import{L as m,b as h,c as u,F as x,a as j,d as p,e as v,f as N}from"./Layout-Cm6lD_Oj.js";import{d as f,e as g}from"./index-Dp7F7cCd.js";import{R as b,C as y}from"./ReactTimeAgo-D_6RWNux.js";import"./iconBase-GrFdhYN9.js";const C=({user:e})=>s.jsxs("div",{className:"about-section",children:[s.jsx("h2",{children:"About"}),s.jsxs("div",{className:"info-item",children:[s.jsx("i",{className:"fas fa-map-marker-alt"}),s.jsx("span",{children:e.location})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("i",{className:"fas fa-briefcase"}),s.jsx("span",{children:e.work})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("i",{className:"fas fa-graduation-cap"}),s.jsx("span",{children:e.education})]})]}),k=({isOpen:a,onClose:i,post:l,onSuccess:t})=>{const[n]=e(),[c,o]=r.useState(""),[d,m]=r.useState([]),[h,u]=r.useState([]),[x,j]=r.useState([]),[p,v]=r.useState([]),[N,f]=r.useState([]),[g,b]=r.useState([]),[y,C]=r.useState([]),[k,S]=r.useState([]),[P,w]=r.useState(!1),[I,L]=r.useState(""),R=r.useRef(null),A=r.useRef(null);r.useEffect(()=>{l&&a&&(o(l.content||""),m(l.images||[]),u(l.videos||[]),j(l.images||[]),v(l.videos||[]),f([]),b([]),C([]),S([]),L(""))},[l,a]);return a&&l?s.jsx("div",{className:"edit-modal-overlay",onClick:i,children:s.jsxs("div",{className:"edit-modal-content",onClick:s=>s.stopPropagation(),children:[s.jsxs("div",{className:"edit-modal-header",children:[s.jsx("h3",{children:"Edit Post"}),s.jsx("button",{className:"edit-modal-close",onClick:i,children:"×"})]}),s.jsxs("div",{className:"edit-modal-body",children:[I&&s.jsx("div",{className:"edit-error-message",children:I}),s.jsxs("div",{className:"edit-content-section",children:[s.jsx("label",{children:"Content:"}),s.jsx("textarea",{value:c,onChange:s=>o(s.target.value),placeholder:"What's on your mind?",rows:4})]}),x.length>0&&s.jsxs("div",{className:"edit-existing-media",children:[s.jsx("label",{children:"Current Images:"}),s.jsx("div",{className:"edit-media-grid",children:x.map((e,a)=>s.jsxs("div",{className:"edit-media-item",children:[s.jsx("img",{src:e,alt:`image-${a}`}),s.jsx("button",{className:"remove-media-btn",onClick:()=>(s=>{const e=d.findIndex(e=>e===x[s]);-1!==e&&C([...y,e]),j(x.filter((e,a)=>a!==s))})(a),children:"×"})]},a))})]}),p.length>0&&s.jsxs("div",{className:"edit-existing-media",children:[s.jsx("label",{children:"Current Videos:"}),s.jsx("div",{className:"edit-media-grid",children:p.map((e,a)=>s.jsxs("div",{className:"edit-media-item",children:[s.jsx("video",{src:e,controls:!0}),s.jsx("button",{className:"remove-media-btn",onClick:()=>(s=>{const e=h.findIndex(e=>e===p[s]);-1!==e&&S([...k,e]),v(p.filter((e,a)=>a!==s))})(a),children:"×"})]},a))})]}),N.length>0&&s.jsxs("div",{className:"edit-new-media",children:[s.jsx("label",{children:"New Images:"}),s.jsx("div",{className:"edit-media-grid",children:N.map((e,a)=>s.jsxs("div",{className:"edit-media-item",children:[s.jsx("img",{src:URL.createObjectURL(e),alt:`new-image-${a}`}),s.jsx("button",{className:"remove-media-btn",onClick:()=>(s=>{f(N.filter((e,a)=>a!==s))})(a),children:"×"})]},a))})]}),g.length>0&&s.jsxs("div",{className:"edit-new-media",children:[s.jsx("label",{children:"New Videos:"}),s.jsx("div",{className:"edit-media-grid",children:g.map((e,a)=>s.jsxs("div",{className:"edit-media-item",children:[s.jsx("video",{src:URL.createObjectURL(e),controls:!0}),s.jsx("button",{className:"remove-media-btn",onClick:()=>(s=>{b(g.filter((e,a)=>a!==s))})(a),children:"×"})]},a))})]}),s.jsxs("div",{className:"edit-file-inputs",children:[s.jsxs("div",{className:"file-input-group",children:[s.jsx("label",{children:"Add Images:"}),s.jsx("input",{type:"file",ref:R,multiple:!0,accept:"image/*",onChange:s=>{const e=Array.from(s.target.files);f(e)},style:{display:"none"}}),s.jsx("button",{className:"file-input-btn",onClick:()=>{var s;return null==(s=R.current)?void 0:s.click()},children:"Choose Images"})]}),s.jsxs("div",{className:"file-input-group",children:[s.jsx("label",{children:"Add Videos:"}),s.jsx("input",{type:"file",ref:A,multiple:!0,accept:"video/*",onChange:s=>{const e=Array.from(s.target.files);b(e)},style:{display:"none"}}),s.jsx("button",{className:"file-input-btn",onClick:()=>{var s;return null==(s=A.current)?void 0:s.click()},children:"Choose Videos"})]})]})]}),s.jsxs("div",{className:"edit-modal-footer",children:[s.jsx("button",{className:"btn-cancel",onClick:i,disabled:P,children:"Cancel"}),s.jsx("button",{className:"btn-save",onClick:async()=>{var s;if(l){w(!0),L("");try{const s=new FormData;s.append("content",c),N.forEach(e=>{s.append("images",e)}),g.forEach(e=>{s.append("videos",e)}),y.length>0&&s.append("removeImages",JSON.stringify(y)),k.length>0&&s.append("removeVideos",JSON.stringify(k)),await n({postId:l._id,body:s}).unwrap(),t(),i()}catch(e){console.error("Error updating post:",e),L((null==(s=e.data)?void 0:s.message)||"Failed to update post. Please try again.")}finally{w(!1)}}},disabled:P,children:P?"Saving...":"Save Changes"})]})]})}):null},S=({message:e,onConfirm:a,onCancel:i,confirmText:l="Yes",cancelText:t="No",open:n})=>n?s.jsx("div",{className:"confirm-modal-overlay",children:s.jsxs("div",{className:"confirm-box",children:[s.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close",children:"×"}),s.jsx("p",{className:"confirm-message",children:e}),s.jsxs("div",{className:"confirm-buttons",children:[s.jsx("button",{className:"confirm-btn confirm-yes",onClick:a,children:l}),s.jsx("button",{className:"confirm-btn confirm-no",onClick:i,children:t})]})]})}):null,P=()=>{var e;const{user:n}=a(s=>s.user),{data:c,isLoading:o,error:d}=i(),[j]=l(),p=c||[],[v,N]=r.useState(!1),[g,C]=r.useState([]),[P,w]=r.useState(0),[I,L]=r.useState(!1),[R,A]=r.useState(null),[E,z]=r.useState(!1),[F,O]=r.useState(null),T=(s,e)=>{C(s),w(e),N(!0)},U=()=>{N(!1),C([]),w(0)};return o?s.jsx(m,{}):s.jsxs("div",{className:"d-flex flex-column",children:[v&&s.jsx("div",{className:"media-modal-overlay",onClick:U,children:s.jsxs("div",{className:"media-modal-content",onClick:s=>s.stopPropagation(),children:[s.jsx("button",{className:"media-modal-close",onClick:U,children:"×"}),s.jsx("button",{className:"media-modal-prev",onClick:()=>{w(s=>0===s?g.length-1:s-1)},children:"<"}),s.jsx("button",{className:"media-modal-next",onClick:()=>{w(s=>s===g.length-1?0:s+1)},children:">"}),"image"===(null==(e=g[P])?void 0:e.type)?s.jsx("img",{src:g[P].src,alt:"media",className:"media-modal-img"}):s.jsx("video",{src:g[P].src,controls:!0,className:"media-modal-video"})]})}),s.jsx(k,{isOpen:I,onClose:()=>{L(!1),A(null)},post:R,onSuccess:()=>{console.log("Post updated successfully")}}),s.jsx(S,{open:E,message:"Are you sure you want to delete this post? This action cannot be undone.",onConfirm:()=>F&&(async s=>{var e;try{await j(s).unwrap(),t.success("Post deleted successfully")}catch(a){t.error((null==(e=a.data)?void 0:e.message)||"Failed to delete post")}z(!1),O(null)})(F._id),onCancel:()=>{z(!1),O(null)},confirmText:"Delete",cancelText:"Cancel"}),null==p?void 0:p.map(e=>{var a,i;const l=[...(null==(a=e.images)?void 0:a.map(s=>({type:"image",src:s})))||[],...(null==(i=e.videos)?void 0:i.map(s=>({type:"video",src:s})))||[]];return s.jsxs("div",{className:"post-list",children:[s.jsxs("div",{className:"post-list-header",children:[s.jsxs("div",{className:"post-list-header-left",children:[s.jsx("img",{src:e.author.profilePicture,alt:"avatar"}),s.jsxs("div",{className:"post-list-header-info",children:[s.jsxs("span",{className:"post-list-header-info-name",children:[e.author.firstName," ",e.author.lastName]}),s.jsxs("span",{className:"post-list-header-info-time",children:[s.jsx(b,{date:e.createdAt,locale:"en-EN"}),e.isEdited&&s.jsx("span",{className:"post-edited-indicator",children:" (edited)"})]})]})]}),s.jsxs("div",{className:"post-list-header-right",children:[s.jsx("button",{className:"btn-edit",onClick:()=>(s=>{A(s),L(!0)})(e),children:s.jsx(h,{})}),s.jsx("button",{className:"btn-delete",onClick:()=>(s=>{O(s),z(!0)})(e),children:s.jsx(u,{})})]})]}),s.jsxs("div",{className:"post-list-content",children:[s.jsx("div",{className:"post-list-content-text",children:s.jsx("span",{children:e.content})}),1===l.length?s.jsx("div",{className:"post-list-content-single-media",onClick:()=>T(l,0),children:"image"===l[0].type?s.jsx("img",{src:l[0].src,alt:"gallery",loading:"lazy"}):s.jsx("video",{src:l[0].src,loading:"lazy"})}):l.length>1&&s.jsx("div",{className:"post-list-gallery-grid",children:l.slice(0,4).map((e,a)=>s.jsxs("div",{className:"post-list-gallery-item",onClick:()=>T(l,a),children:["image"===e.type?s.jsx("img",{src:e.src,alt:"gallery",loading:"lazy"}):s.jsx("video",{src:e.src,loading:"lazy"}),3===a&&l.length>4&&s.jsxs("div",{className:"post-list-gallery-more",children:["+",l.length-4]})]},a))})]}),s.jsxs("div",{className:"post-list-footer",children:[s.jsx("span",{className:"post-list-footer-like",children:s.jsx(x,{})}),s.jsx("span",{className:"post-list-footer-share",children:s.jsx(f,{})})]}),s.jsx(y,{postId:e._id,comments:e.comments,currentUser:n})]},e._id)})]})},w="https://avitek.vn/wp-content/uploads/2020/08/Image-Placeholder-Dark.png",I=()=>{var e,i,l;const{user:t}=a(s=>s.user),{data:h,isLoading:u}=n(null==t?void 0:t.id,{skip:!(null==t?void 0:t.id)}),{data:x,isLoading:f}=c(null==t?void 0:t.id,{skip:!(null==t?void 0:t.id)}),[b,y]=r.useState("about"),[k,{isLoading:S}]=o(),[I,{isLoading:L}]=d(),R=r.useRef(null),A=r.useRef(null),E=async(s,e)=>{if(e)try{const a=null==t?void 0:t.id;"profilePicture"===s?k({userId:a,file:e}):"coverPhoto"===s&&I({userId:a,file:e})}catch(a){console.error("Error uploading image:",a)}};return s.jsxs(j,{children:[(S||L)&&s.jsx("div",{className:"profile-loading-overlay",children:s.jsx(m,{})}),s.jsx("div",{className:"profile flex-2",children:s.jsxs("div",{className:"profile-content",children:[s.jsxs("div",{className:"cover-photo",children:[s.jsx("img",{src:(null==t?void 0:t.coverPhoto)||w,alt:"Cover",loading:"lazy"}),s.jsxs("div",{className:"cover-photo-overlay",onClick:()=>{var s;null==(s=R.current)||s.click()},children:[s.jsx("div",{className:"upload-icon",children:s.jsx(p,{})}),s.jsx("span",{children:"Change Cover Photo"})]}),s.jsx("input",{ref:R,type:"file",accept:"image/*",onChange:s=>{const e=s.target.files[0];e&&e.type.startsWith("image/")&&E("coverPhoto",e)},style:{display:"none"}}),s.jsxs("div",{className:"profile-picture",children:[s.jsx("img",{src:(null==t?void 0:t.profilePicture)||w,alt:(null==t?void 0:t.fullName)||"Profile",loading:"lazy"}),s.jsx("div",{className:"profile-picture-overlay",onClick:()=>{var s;null==(s=A.current)||s.click()},children:s.jsx("div",{className:"upload-icon",children:s.jsx(p,{})})}),s.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:s=>{const e=s.target.files[0];e&&e.type.startsWith("image/")&&E("profilePicture",e)},style:{display:"none"}})]})]}),s.jsxs("div",{className:"profile-info",children:[s.jsx("div",{className:"profile-header",children:s.jsxs("div",{className:"profile-name-section",children:[s.jsx("h1",{children:null==t?void 0:t.fullName}),s.jsxs("div",{className:"username",children:["@",null==t?void 0:t.username]}),s.jsx("p",{className:"bio",children:null==t?void 0:t.bio})]})}),u||f?s.jsx("div",{className:"profile-stats loading",children:"Loading statistics..."}):s.jsxs("div",{className:"profile-stats",children:[s.jsxs("div",{className:"stat-item",title:"Posts",children:[s.jsx(g,{className:"stat-icon"}),s.jsx("span",{children:(null==(e=null==h?void 0:h.stats)?void 0:e.postsCount)??(null==x?void 0:x.postsCount)??0}),s.jsx("span",{className:"stat-label",children:"Posts"})]}),s.jsxs("div",{className:"stat-item",title:"Photos",children:[s.jsx(v,{className:"stat-icon"}),s.jsx("span",{children:(null==(i=null==h?void 0:h.stats)?void 0:i.photosCount)??0}),s.jsx("span",{className:"stat-label",children:"Photos"})]}),s.jsxs("div",{className:"stat-item",title:"Friends",children:[s.jsx(N,{className:"stat-icon"}),s.jsx("span",{children:(null==(l=null==h?void 0:h.stats)?void 0:l.friendsCount)??0}),s.jsx("span",{className:"stat-label",children:"Friends"})]})]})]}),s.jsxs("div",{className:"profile-nav",children:[s.jsx("button",{className:"nav-item "+("about"===b?"active":""),onClick:()=>y("about"),children:"About"}),s.jsx("button",{className:"nav-item "+("posts"===b?"active":""),onClick:()=>y("posts"),children:"Posts"})]}),s.jsxs("div",{className:"profile-main",children:["about"===b&&s.jsx(C,{user:t}),"posts"===b&&s.jsx(P,{})]})]})})]})};export{I as default};
//# sourceMappingURL=Profile-CcEhebVk.js.map
